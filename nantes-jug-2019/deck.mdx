import { Head, Image, Root, Flex, Appear } from 'mdx-deck'
import { Invert, Split, FullScreen, SplitRight } from 'mdx-deck/layouts'
import { CodeSurfer } from "mdx-deck-code-surfer"
import Box from 'superbox'
import DemoStarwars from './DemoStarwars'
import SplitElement from './SplitElement'
import AppearDisappear from './AppearDisappear'
import base  from 'mdx-deck/themes'
import Highlight, { defaultProps } from "prism-react-renderer"
import nightOwl from "prism-react-renderer/themes/nightOwl"
import Code from './Code'


export const theme = {
  ...base,  
  //font: 'Roboto, sans-serif',
  font: 'system-ui, sans-serif',
  codeSurfer: {
    ...nightOwl,
    showNumbers: false
  }
}



<Head>
  <title>R + Java = üíõ</title>

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@_bruno_b_" />
  <meta name="twitter:title" content="R + Java = üíõ" />
  <meta name="twitter:description" content="Presentation faite au Nantes JUG en f√©vrier 2019 sur le langage R √† destination des Devs Java" />
  <meta name="twitter:image" content="https://raw.githubusercontent.com/bbonnin/talk-r-java-graalvm/master/nantes-jug-2019/img/card.png" />
</Head>

# R + Java = üíõ

<small>(ou 'comment mettre de la data science dans sa webapp avec GraalVM')</small>

Nantes JUG - F√©vrier 2019


```notes
Bonjour √† tous et bienvnue √† ce quickie sur le monde merveilleux de R √† destination des d√©veloppeurs Java.
```

---

export default Split

<Box>
  <h2>whoami</h2>
  <p>Bruno Bonnin - @_bruno_b_</p>
  <i>Vieux d√©veloppeur</i>
</Box>

<SplitElement img="img/haddock.png" backgroundColor="black" color="white"/>

```notes
Bien, tout d'abord, je me pr√©sente rapidement, blablabla...
```

---

# Avertissement

Ce talk s'adresse aux personnes qui ne connaissent pas le langage R
mais ne fait qu'effleurer le sujet. 
Ce talk n'est pas une introduction √† GraalVM, mais plus une intro √† la data science
pour les d√©veloppeurs Java qui voudraient comprendre un monde √©trange, le langage R
et ses m√©andres.

https://github.com/neomatrix369/awesome-graal
 
---

export default Split

<SplitElement img="img/Rlogo.png" backgroundColor="white" color="white"/>

<Box is="div" p={4}>
  <h2>Langage de script</h2>
  <p>Invent√© en 1993 (Universit√© d'Auckland)</p>
  <p>D√©di√© aux statistiques, tr√®s utilis√© dans le monde de la data science</p>
  <p>Grande communaut√©, beaucoup de librairies</p>
  <p>Open source</p>
</Box>

[www.r-project.org](https://www.r-project.org/)

```notes
Qu'est-ce que R ?
R est langage essentiellement fait pour les statisticiens (Java non !!)
R fournit beaucoup de fonctions pour triturer la donn√©es dans tous les sens 
(d'un point de vue statistiques, bien s√ªr) (Java non !!)
Manipulation de donn√©es, calcul, pr√©paration
```

---

<CodeSurfer
  title="Les interpr√©teurs"
  code={require("!raw-loader!./snippets/start.R")}
  steps={[
    { range: [1, 1], notes: "C'est parti !!!" },
    { range: [1, 6], notes: "R : pour Lancement de l'interpr√©teur en mode interactif" },
    { range: [8, 10], notes: "" },
    { range: [13, 14], notes: "Rscript : pour lancement de commandes ou de fichiers" }
  ]}
/>

```notes
Pour bien commencer avec R, vous allez installer un interpr√©teur, en g√©n√©ral, celui fourni sur
le site officiel de R.
Et vous pourrez, alors, attaquer directement vos d√©veloppements !!
```

---

# Codons üíª !

---

<CodeSurfer
  title="La base"
  code={require("!raw-loader!./snippets/base.R")}
  steps={[
    { range: [1, 3], notes: "Les types de base (character, numeric, logical)" },
    { range: [5, 16], notes: "Boucles, conditions, ..." },
    { range: [18, 24], notes: "Les fonctions" }
  ]}
/>

---

<CodeSurfer
  title="Focus sur les vecteurs..."
  code={require("!raw-loader!./snippets/vector.R")}
  lang="python"
  showNumbers={false}
  steps={[
    { range: [1, 5], notes: "Dans un vecteur, tous les √©l√©ments sont de m√™me type" },
    { range: [7, 13], notes: "Acc√®s aux √©l√©ments d'un vecteur" },
    { range: [15, 19], notes: "Quelques op√©rations" },
    { range: [21, 27], notes: "Nommage des √©l√©ments" },
    { range: [29, 32], notes: "Fonctions sur les vecteurs" }
  ]}
/>

```notes
Vecteurs: ensemble d'√©l√©ments de m√™me types (conversion automatiques)
et le premier indice est 1 !!!
```

---

<CodeSurfer
  title="... et les matrices"
  code={require("!raw-loader!./snippets/matrix.R")}
  lang="python"
  showNumbers={false}
  steps={[
    { range: [1, 8], notes: "Dans une matrice, tous les √©l√©ments sont de m√™me type" },
    { range: [10, 12], notes: "Acc√®s aux √©l√©ments d'une matrice" },
    { range: [14, 24], notes: "Cr√©ation de la matrice √† partir du vecteur" },
    { range: [26, 34], notes: "Nommage des colonnes/lignes" },
    { range: [36, 38], notes: "Acc√®s aux √©l√©ments" },
    { range: [40, 42], notes: "Fonctions de base sur les √©l√©ments" }
  ]}
/>

```notes
Tableau √† deux dimensions.
Pour construire une matrice, on part d'un set de donn√©es.
```

---

![](img/builtin_fcts.png)

---

<CodeSurfer
  title="Les data frames"
  code={require("!raw-loader!./snippets/dataframe.R")}
  lang="python"
  showNumbers={false}
  steps={[
    { range: [1, 1], notes: "Chargement des donn√©es" },
    { range: [3, 6], notes: "Premiers √©l√©ments de la data frame" },
    { range: [8, 11], notes: "Structure des donn√©es" },
    { range: [13, 21], notes: "Informations sur les donn√©es" },
    { range: [23, 28], notes: "Ajout d'une colonne" },
    { range: [30, 32], notes: "Op√©rations sur les √©l√©ments" }
  ]}
/>

```notes
Data frames (tableau √† 2 dimensiopns)
Il peut y avoir des types diff√©rents, mais 
dans une colonne, tous les √©l√©ments doivent avoir le m√™me type.
```

---

export default Split

<Code title="Graphiques" code={require("!raw-loader!./snippets/plots.R")}/>

<SplitElement img="img/plots.png" backgroundColor="white" color="black"/>

```notes
ajout d'une droite de regression avec un intervalle de confiance
lm = linear model
```

---

<Image
  src='img/r-packages.png'
  size='contain'
/>

---

## Les packages

CRAN - Comprehensive R Archive Network

<a href="https://cran.r-project.org/web/packages/available_packages_by_name.html" target="_blank">https://cran.r-project.org/</a>


```notes
Sympa, riche
Bcp de mirroirs (dont certains avec leurs propres packages : se rapproche d'un mod√®le de type yum)
```

---

<CodeSurfer
  title="Packages"
  code={require("!raw-loader!./snippets/packages.R")}
  lang="python"
  showNumbers={false}
  steps={[
    {},
    { range: [1, 2], notes: "Installation depuis les repos du CRAN" },
    { range: [4, 7] },
    { range: [9, 10] },
    { range: [12, 13], notes: "Utilisation d'une librairie install√©e"},
    { range: [15, 22], notes: "Installation depuis des sources diverses" }
  ]}
/>

---

export default Split

<SplitElement img="img/ide_r.png" title="R" subtitle="R Studio, Jupyter, ..." backgroundColor="black" color="white"/>

<SplitElement img="img/ide_java.png" title="Java" subtitle="Intellij, Eclipse, ..." backgroundColor="white" color="black"/>

---

# R + Java ?

---

<CodeSurfer
  title="rJava"
  code={require("!raw-loader!./snippets/rjava.R")}
  lang="python"
  steps={[
    { notes: "Librairie d'interface avec Java (via JNI)" }
  ]}
/>

---

<CodeSurfer
  title="Renjin"
  code={require("!raw-loader!./snippets/renjin.java")}
  lang="java"
  steps={[
    { notes: "Interpr√©teur R pour la JVM (www.renjin.org)" },
    { range: [9, 13], notes: "Cr√©ation du moteur R" },
    { range: [15, 17], notes: "Interpr√©tation du code R" }
  ]}
/>

```notes
toutes les lib ne sont pas compatibles...
http://docs.renjin.org/en/latest/interactive/index.html
```

---

<img src="img/graalvm_logo.png" width="100%"/>

---

export default Split

<img src="img/graalvm.png" width="90%"/>

<Box is="div" p={4} fontSize={1}>
  <h2>Polyglot Virtual Machine</h2>
  <p>
  <span style={{fontSize: 'xx-large'}}>&laquo;</span><b>GraalVM</b> <small>is a universal virtual machine for running applications written in JavaScript, Python, Ruby,</small>
   <b> R</b><small>, JVM-based languages, and LLVM-based languages such as C and C++.</small><span style={{fontSize: 'xx-large'}}>&raquo;</span>
  </p>
  <p>
  <span style={{fontSize: 'xx-large'}}>&laquo;</span> <b>GraalVM</b> <small> removes the isolation between programming languages and enables interoperability in a shared runtime. 
    It can run either standalone or in the context of OpenJDK, Node.js, Oracle Database, or MySQL.</small><span style={{fontSize: 'xx-large'}}>&raquo;</span>
  </p>
</Box>


```notes
Peut faire tourner des programmes √©crits dans tous ces langages.
Permet aussi de prendre le meilleur de chacun des langages et de les mixer !!
Parler du fait, qu'avec GraalVM, on va pouvoir construire des applications polyglot
et performante (image native), avec une bien meilleure int√©gration des diff√©rentes competences 
developpeurs/statisticiens/data scientists

Graal: JIT compilateur
Truffle: Cadre d'impl√©mentation linguistique / Interpr√®te AST
Substrate VM: Java AOT, Biblioth√®ques et outils d'ex√©cution pour la construction de code compil√©
```

---

<img src="img/graalvm_archi.png" width="80%" />

---

## Demo - Box Office Star Wars

<img src="img/graalvm_demo.png" width="80%" />

<!--DemoStarwars/-->

```notes
[https://github.com/bbonnin/talk-de-l-r-les-devs-java/tree/master/java-r](https://github.com/bbonnin/talk-de-l-r-les-devs-java/tree/master/java-r)
```

---

<CodeSurfer
  title="GraalVM (Java part)"
  code={require("!raw-loader!./snippets/plot_service.java")}
  lang="java"
  steps={[
  { notes: "Service construisant un SVG" },
    { range: [5, 6], notes: "Initialisation du contexte GraalVM" },
    { range: [8, 13], notes: "Chargement du code R" },
    { range: [15, 27], "notes": "Service web d'acc√®s au SVG" },
    { range: [21, 22], notes: "Appel de la fonction R, qui retourne le SVG" }
  ]}
/>

```notes
Le moteur de R est FastR (d'Oracle)
```

---

<CodeSurfer
  title="GraalVM (R part)"
  code={require("!raw-loader!./snippets/plot_service.R")}
  lang="python"
  steps={[
    { notes: "Fonction R construisant un SVG" },
    { lines: [4, 9, 10], notes: "Utilisation d'un type (classe) venant de Java"},
    { lines: [6, 12], notes: "Utilisation direct de l'attribut filename (String)" },
    { lines: [6, 14, 15, 16, 17], notes: "Utilisation de l'attribut trilogies (tableau d'entiers)" },
    { range: [21, 25], notes: "Construction du SVG avec ggplot2 et retour du SVG" }
  ]}
/>

```notes
Le moteur de R est FastR (d'Oracle ?)

```

---

<Image src="img/batman_superman.jpg" size="contain"/>

```notes
Donc, au tout d√©but, j'avais un peu l'impression qu'il y avait 2 mondes qui se faisait face, chacun montrant
ses muscles √† l'autre, mais au final, chacun a ses forces et ses faiblesses, mais je pense qu'avec GraalVM, on pourrait
avoir dans un proche avenir une coop√©ration forte o√π chaque technologie pourra collaborer.
```
---

# Pour aller plus loin

* https://www.r-project.org/
* https://www.meetup.com/fr-FR/Meetup-R-Nantes
* https://www.graalvm.org/
* https://github.com/bbonnin/graalvm-examples

---

# Merci !

[https://github.com/bbonnin/talk-r-java-graalvm](https://github.com/bbonnin/talk-r-java-graalvm)