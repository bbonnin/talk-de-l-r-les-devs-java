import { Head, Image, Root, Flex, Appear } from 'mdx-deck'
import { Invert, Split, FullScreen, SplitRight } from 'mdx-deck/layouts'
import { CodeSurfer } from "mdx-deck-code-surfer"
import Box from 'superbox'
import DemoStarwars from './DemoStarwars'
import SplitElement from './SplitElement'
import AppearDisappear from './AppearDisappear'
import base  from 'mdx-deck/themes'
import Highlight, { defaultProps } from "prism-react-renderer"
import nightOwl from "prism-react-renderer/themes/nightOwl"
import Code from './Code'


export const theme = {
  ...base,  
  //font: 'Roboto, sans-serif',
  font: 'system-ui, sans-serif',
  codeSurfer: {
    ...nightOwl,
    showNumbers: false
  }
}



<Head>
  <title>R + Java = üíõ</title>

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@_bruno_b_" />
  <meta name="twitter:title" content="R + Java = üíõ" />
  <meta name="twitter:description" content="Presentation faite au Nantes JUG en f√©vrier 2019 sur le langage R √† destination des Devs Java" />
  <meta name="twitter:image" content="https://raw.githubusercontent.com/bbonnin/talk-r-java-graalvm/master/nantes-jug-2019/img/card.png" />
</Head>

# R + Java = üíõ

<small>(ou "<i>comment mettre de la data science dans sa webapp avec GraalVM</i>")</small>

Bruno Bonnin

*Nantes JUG - F√©vrier 2019*




```notes
Bonjour √† tous et bienvnue √† ce quickie sur le monde merveilleux de R √† destination des d√©veloppeurs Java.
```

---

export default Split

<SplitElement img="img/Rlogo.png" backgroundColor="white" color="white"/>

<Box is="div" p={4}>
  <h2>Langage de script</h2>
  <p>Invent√© en 1993 (Universit√© d'Auckland)</p>
  <p>√Ä l‚Äôorigine: S, un langage pour "programmer avec des donn√©es"</p>
  <p>D√©di√© √† la manipulation de donn√©es, aux calculs et aux graphiques</p>
  <p>Tr√®s utilis√© dans le monde de la data science</p>
  <p>Open source</p>
</Box>

[www.r-project.org](https://www.r-project.org/)

```notes
Qu'est-ce que R ?
R est langage essentiellement fait pour les statisticiens (Java non !!)
R fournit beaucoup de fonctions pour triturer la donn√©es dans tous les sens 
(d'un point de vue statistiques, bien s√ªr) (Java non !!)
Manipulation de donn√©es, calcul, pr√©paration
```

---

<CodeSurfer
  title="Les interpr√©teurs"
  code={require("!raw-loader!./snippets/start.R")}
  steps={[
    { range: [1, 1], notes: "C'est parti !!!" },
    { range: [1, 6], notes: "R : pour Lancement de l'interpr√©teur en mode interactif" },
    { range: [8, 10], notes: "" },
    { range: [13, 14], notes: "Rscript : pour lancement de commandes ou de fichiers" }
  ]}
/>

```notes
Pour bien commencer avec R, vous allez installer un interpr√©teur, en g√©n√©ral, celui fourni sur
le site officiel de R.
Et vous pourrez, alors, attaquer directement vos d√©veloppements !!
```

---

# Maintenant, on peut coder üíª !

---

<CodeSurfer
  title="La base"
  code={require("!raw-loader!./snippets/base.R")}
  steps={[
    { range: [1, 3], notes: "Les types de base (character, numeric, logical)" },
    { range: [5, 16], notes: "Boucles, conditions, ..." },
    { range: [18, 24], notes: "Les fonctions" }
  ]}
/>

---

<CodeSurfer
  title="R, pour les calculs..."
  code={require("!raw-loader!./snippets/calcul.R")}
  lang="python"
  showNumbers={false}
  steps={[
    { range: [1, 5], notes: "Dans un vecteur, tous les √©l√©ments sont de m√™me type" },
    { range: [7, 10], notes: "Quelques op√©rations" },
    { range: [12, 15], notes: "Fonctions sur les vecteurs" },
    { range: [17, 22], notes: "Acc√®s aux √©l√©ments d'un vecteur" },
    { range: [24, 26], notes: "Nommage des √©l√©ments" },
    { range: [28, 34], notes: "Dans une matrice, tous les √©l√©ments sont de m√™me type" },
    { range: [36, 37], notes: "Acc√®s aux √©l√©ments d'une matrice" },
    { range: [39, 42], notes: "Op√©rations sur les matrices" },
    { range: [44, 46], notes: "Fonctions de base sur les √©l√©ments" }
    
  ]}
/>

```notes
Vecteurs: ensemble d'√©l√©ments de m√™me types (conversion automatiques)
et le premier indice est 1 !!!
```

---

<CodeSurfer
  title="R, pour la manipulation de donn√©es"
  code={require("!raw-loader!./snippets/dataframe.R")}
  lang="python"
  showNumbers={false}
  steps={[
    { range: [1, 1], notes: "Chargement des donn√©es" },
    { range: [3, 6], notes: "Premiers √©l√©ments de la data frame" },
    { range: [8, 10], notes: "Acc√®s aux √©l√©ments" },
    { range: [12, 15], notes: "Structure des donn√©es" },
    { range: [17, 25], notes: "Informations sur les donn√©es" },
    { range: [27, 32], notes: "Ajout d'une colonne" },
    { range: [34, 36], notes: "Op√©rations sur les √©l√©ments" }
  ]}
/>

```notes
Data frames (tableau √† 2 dimensiopns)
Il peut y avoir des types diff√©rents, mais 
dans une colonne, tous les √©l√©ments doivent avoir le m√™me type.
```

---

export default Split

<Code title="R, pour les graphiques" code={require("!raw-loader!./snippets/plots.R")}/>

<SplitElement img="img/plots.png" backgroundColor="white" color="black"/>

```notes
ajout d'une droite de regression avec un intervalle de confiance
lm = linear model
```

---

<Image
  src='img/r-packages.png'
  size='contain'
/>

---

## Les packages

CRAN - Comprehensive R Archive Network

<a href="https://cran.r-project.org/web/packages/available_packages_by_name.html" target="_blank">https://cran.r-project.org/</a>


```notes
Sympa, riche
Bcp de mirroirs (dont certains avec leurs propres packages : se rapproche d'un mod√®le de type yum)
```

---

<CodeSurfer
  title="Packages"
  code={require("!raw-loader!./snippets/packages.R")}
  lang="python"
  showNumbers={false}
  steps={[
    {},
    { range: [1, 1], notes: "Installation depuis les repos du CRAN" },
    { range: [3, 3], notes: "Suppression d'un package" },
    { range: [5, 5], notes: "Utilisation d'une librairie install√©e"},
    { range: [7, 13], notes: "Installation depuis des sources diverses, hors CRAN" }
  ]}
/>

---

<CodeSurfer
  title="Manipulation de donn√©es avec dyplr"
  code={require("!raw-loader!./snippets/packages_ex.R")}
  lang="python"
  steps={[
    { range: [1, 7], notes: "Les packages peuvent n'√™tre que des donn√©es !" },
    { range: [9, 29], notes: "Exploration avec dyplr" },
    { range: [31, 37], notes: "Inspir√© par le package magrittr" },
    { range: [39, 42], notes: "Un dernier pour la route" }
  ]}
/>

---

# R + Java ?

---

<CodeSurfer
  title="rJava"
  code={require("!raw-loader!./snippets/rjava.R")}
  lang="python"
  steps={[
    { notes: "Librairie d'interface avec Java (via JNI)" }
  ]}
/>

---

<CodeSurfer
  title="Renjin"
  code={require("!raw-loader!./snippets/renjin.java")}
  lang="java"
  steps={[
    { notes: "Interpr√©teur R pour la JVM (www.renjin.org)" },
    { range: [9, 13], notes: "Cr√©ation du moteur R" },
    { range: [15, 17], notes: "Interpr√©tation du code R" }
  ]}
/>

```notes
toutes les lib ne sont pas compatibles...
http://docs.renjin.org/en/latest/interactive/index.html
```

---

<img src="img/graalvm_logo.png" width="100%"/>

---

export default Split

<img src="img/graalvm.png" width="90%"/>

<Box is="div" p={4} fontSize={1}>
  <h2>Polyglot Virtual Machine</h2>
  <p>
  <span style={{fontSize: 'xx-large'}}>&laquo;</span><b>GraalVM</b> <small>is a universal virtual machine for running applications written in JavaScript, Python, Ruby,</small>
   <b> R</b><small>, JVM-based languages, and LLVM-based languages such as C and C++.</small><span style={{fontSize: 'xx-large'}}>&raquo;</span>
  </p>
  <p>
  <span style={{fontSize: 'xx-large'}}>&laquo;</span> <b>GraalVM</b> <small> removes the isolation between programming languages and enables interoperability in a shared runtime. 
    It can run either standalone or in the context of OpenJDK, Node.js, Oracle Database, or MySQL.</small><span style={{fontSize: 'xx-large'}}>&raquo;</span>
  </p>
</Box>


```notes
Peut faire tourner des programmes √©crits dans tous ces langages.
Permet aussi de prendre le meilleur de chacun des langages et de les mixer !!
Parler du fait, qu'avec GraalVM, on va pouvoir construire des applications polyglot
et performante (image native), avec une bien meilleure int√©gration des diff√©rentes competences 
developpeurs/statisticiens/data scientists

Graal: JIT compilateur (just in time)
Truffle: Cadre d'impl√©mentation linguistique / Interpr√®te AST
Substrate VM: Java AOT (ahead of time), Biblioth√®ques et outils d'ex√©cution pour la construction de code compil√©
```

---

<img src="img/graalvm_archi.png" width="80%" />

```notes
Le moteur de R est FastR (d'Oracle)
```

---

## Exemple - G√©n√©ration de charts en R servis par un service Java 

<a href="http://localhost:4567/mtcars.html" target="_blank"><img src="img/graalvm_demo.png" width="80%" /></a>

---

<CodeSurfer
  title="GraalVM (Partie Java)"
  code={require("!raw-loader!./snippets/plot_service.java")}
  lang="java"
  steps={[
  { notes: "Service construisant un SVG" },
    { range: [5, 6], notes: "Initialisation du contexte GraalVM" },
    { range: [8, 13], notes: "Chargement du code R" },
    { range: [15, 27], notes: "Service web d'acc√®s au SVG" },
    { range: [20, 21], notes: "Appel de la fonction R, qui retourne le SVG" }
  ]}
/>

---

<CodeSurfer
  title="GraalVM (Partie R)"
  code={require("!raw-loader!./snippets/plot_service.R")}
  lang="python"
  steps={[
    { notes: "Fonction R construisant un SVG" },
    { lines: [4, 9], notes: "Import et utilisation d'une classe Java"},
    { lines: [9, 11], notes: "Utilisation direct de l'attribut type (String)" },
    { range: [11, 29], notes: "Construction du SVG avec ggplot2" }
  ]}
/>

---

<Image src="img/batman_superman.jpg" size="contain"/>

```notes
Donc, au tout d√©but, j'avais un peu l'impression qu'il y avait 2 mondes qui se faisait face, chacun montrant
ses muscles √† l'autre, mais au final, chacun a ses forces et ses faiblesses, mais je pense qu'avec GraalVM, on pourrait
avoir dans un proche avenir une coop√©ration forte o√π chaque technologie pourra collaborer.
```
---

# Pour aller plus loin

* https://www.r-project.org/
* https://www.meetup.com/fr-FR/Meetup-R-Nantes
* http://larmarange.github.io/analyse-R/manipuler-les-donnees-avec-dplyr.html
* https://www.graalvm.org/
* https://github.com/bbonnin/graalvm-examples

---

# Merci !

[github.com/bbonnin/talk-r-java-graalvm](https://github.com/bbonnin/talk-r-java-graalvm)

[bbonnin.github.io/talks/nantes-jug-2019](http://bbonnin.github.io/talks/nantes-jug-2019)